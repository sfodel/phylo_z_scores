# phylo_z_scores
Null modelling of phylogenetic nearest taxon distances for individual taxa

This repository contains the R code to identify taxa that are under homogeneous selection,i.e, taxa (e.g. Sequence Variants in a 16S rRNA gene survey) with phylogenetically closer relatives across communities than expected by chance.
The method consists of the following steps: 
1) For a given pair of communities and for each taxon therein that is not present in both communities, we calculate its z-score from a null distribution of log-transformed minimum phylogenetic distances to assess how different its minimum phylogenetic distance is to that expected by chance. For example, if we examine taxon <i><b>x</i></b> in the community pair <i><b>a-b</i></b> and <i><b>x</i></b> is present in community <i><b>a</i></b> and not in community <i><b>b</i></b>, we first find the minimum phylogenetic distance <i><b>dist</i></b> between <i><b>x</i></b> and all the taxa that are present in community <i><b>b</i></b> and we log-transform it. We then calculate a null distribution of minimum log-transformed phylogenetic distances between <i><b>x</i></b> and these taxa by randomly picking phylogenetic distances from the whole distance pool and assigning them to the taxa in the two communities, with <i><b>null_mean</i></b> and <i><b>null_sd</i></b> being the mean and standard deviation of this distribution. Finally, we calculate the z-score as:
 
       z-score = (log(dist) â€“ null_mean)/null_sd

2) We then calculate for each taxon the average z-score across all community pairs, the number of community pairs it contributed to, and its total score as the multiplication of the two. We use phylofactorization (https://github.com/reptalex/phylofactor, https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1002/ecm.1353) to identify phylogenetic groups with low total scores and to extract the consensus taxonomic classification of the taxa within.
3) We also calculate the median z-score and we classify taxa using a threshold of significance based on a median z-score less than -2. We perceive this threshold as an indication that a given taxon is consistently under the effect of homogeneous selection, because this taxon has phylogenetically nearest neighboring taxa with shorter distances than those expected by chance in at least 50% of the applicable community pairs (i.e., those community pairs where the taxon is found in exactly one of the two communities).
